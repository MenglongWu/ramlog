# RamLog
内存日志 V0.1 

###功能
-
RamLog实现将程序运行日志输出到内存文件系统，当程序崩溃后由子进程将内存文件系统中的日志文件拷贝到存储介质，当然，程序在运行过程中也能强制拷贝。

###怎么使用
-
生成动态链接库

只要2个函数调用

###原理
-
本模块依赖linux的内存文件系统：ramfs或tmpfs等内存文件系统。

主进程fork日志拷维护子进程，子进程长期进入休眠状态。主进程调用rl_snprintf等接口将日志写入到内存中，内存文件系统里建立若干日志文件。当子进程直到探测到主线程已经退出则将主进程写入内存文件系统的日志文件拷贝到存储设备中。

日志文件写入内存文件系统某目录中，该目录大小可做限定。

* 注意：* 
该限定并不表示日志文件永远不超过限定大小，超过的大小依主进程在临界区域最后一次写入的大小

如限定目录大小为10KB，已经占用9KB，再一次性写入50KB日志，此时日志文件大小将达59KB，然而通常日志单次写入都在100Byte以下，所以如此大的超额使用很难碰到。

可配置单个日志文件大小，日志文件名命名格式logprefix-date-sn，例如：
```
demolog-20160803-12-32-21-0
demolog-20160803-12-32-21-1
demolog-20160803-12-32-21-2
```
当中的时间表示程序起始运行时间，后面的序号递增，序号连续的日志内容连续。

* 注意 *
建议将改大小设置成存储设备最小扇区大小的整数倍，如扇区为4KB，则单个文件划分成4KB、8KB等。


* TODO *
- 主进程和子进程采用内存通信方式，
    - 主进程向共享内存里填写数据
    - 内存维护需要同步，保证主进程里多线程访问内存不冲突
    - 共享内存或许采用乒乓缓存（或许实现起来效率也不见得高）
- 当主进程崩溃后，首先将共享内存的数据拷贝到ramfs，在将ramfs的数据拷贝到存储设备
    - 编写测试代码，测试共享内存方式效率是否能达到printf的数倍

###性能
-
目前性能远不如直接使用printf，后期修改接口保证能达到printf的数倍

###思想
-
写日志的开销应该尽可能的小，不应占用太多时间成为妨碍系统的性能

